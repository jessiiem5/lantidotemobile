function contest_countdown() {
    var t = jQuery;
    t(".fca_cc_countdown").each(function() {
        var c = t(this).data("seconds");
        0 > c - 1 ? (c = 0, t(this).siblings("#fca_cc_enter_button").hide(), t(this).siblings(".fca_cc_contest_ended").show()) : c -= 1, t(this).data("seconds", c);
        var i = parse_time(c);
        t(this).find(".fca_cc_time_days").html(i.days), t(this).find(".fca_cc_time_hours").html(i.hours), t(this).find(".fca_cc_time_minutes").html(i.minutes), t(this).find(".fca_cc_time_seconds").html(i.seconds)
    })
}

function parse_time(t) {
    t = parseInt(t);
    var c = Math.floor(t / 86400),
        i = Math.floor(t / 3600) % 24,
        e = Math.floor(t / 60) % 60,
        n = t % 60;
    return {
        days: c,
        hours: i,
        minutes: e,
        seconds: n
    }
}

function add_entry(t, c, i, p) {
    jQuery.ajax({
        url: i.ajaxurl,
        type: "POST",
        data: {
            action: "fca_cc_entry",
            nonce: i.nonce,
            post_id: i.post_id,
            name: t,
            email: c,
            tel: p
        }
    }).done(function(t) {
        (t.success || "exists" == t.data) && set_cookie("fca_cc_entry_" + i.post_id, 1, 365), console.log(t)
    })
}

function set_cookie(t, c, i) {
    var e = new Date;
    e.setTime(e.getTime() + 24 * i * 60 * 60 * 1e3), document.cookie = t + "=" + c + "; expires=" + e.toUTCString()
}

function get_cookie(t) {
    var c = "; " + document.cookie,
        i = c.split("; " + t + "=");
    return 2 === i.length ? i.pop().split(";").shift() : !1
}
jQuery(document).ready(function($) {
    $(".fca_cc_contest").each(function() {
        var t = $(this).data("postid");
        "" != get_cookie("fca_cc_entry_" + t) && ($(this).find(".fca_cc_button").hide(), $(this).find(".fca_cc_description").hide(), $(this).find(".fca_cc_contest_entry").hide(), $(this).find(".fca_cc_description_img").show(), $(this).find(".fca_cc_countdown").show(), $(this).find(".fca_cc_contest_results").show())
    }), $(".fca_cc_button").click(function(e) {
        var $div = $(this).closest(".fca_cc_contest");
        $div.find(".fca_cc_optin_input").not(".tooltipstered").tooltipster({
            trigger: "custom",
            maxWidth: 240,
            arrow: !1,
            theme: ["tooltipster-borderless", "tooltipster-contest-cat"]
        });
        var contest = eval("contestData_" + $div.data("postid"));
        if ($div.find(".fca_cc_optin_input").tooltipster("close"), $div.find(".fca_cc_optin_input").removeClass("fca_cc_invalid"), "fca_cc_enter_button" === $(this).attr("id")) contest.hasOwnProperty("user") && ($div.find("#fca_cc_name_input").val(contest.user.name), $div.find("#fca_cc_email_input").val(contest.user.email)), $(this).hide(), $div.find(".fca_cc_description_img").hide(), $div.find(".fca_cc_countdown").hide(), $div.find(".fca_cc_contest_entry").show(), $div.find(".fca_cc_optin_input").first().focus();
        else if ("fca_cc_optin_button" === $(this).attr("id")) {
            var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,
                name = $div.find("#fca_cc_name_input").val(),
                email = $div.find("#fca_cc_email_input").val(),
                email_validated = regex.test(email),
                name_validated = "" !== name || 0 === $div.find("#fca_cc_name_input").length;
            name_validated && email_validated ? (add_entry(name, email, contest), $(this).hide(), $div.find(".fca_cc_description").hide(), $div.find(".fca_cc_contest_entry").hide(), $div.find(".fca_cc_description_img").show(), $div.find(".fca_cc_countdown").show(), $div.find(".fca_cc_contest_results").show()) : email_validated || name_validated ? email_validated ? $div.find("#fca_cc_name_input").addClass("fca_cc_invalid").tooltipster("open").focus() : $div.find("#fca_cc_email_input").addClass("fca_cc_invalid").tooltipster("open").focus() : $div.find("#fca_cc_email_input, #fca_cc_name_input").addClass("fca_cc_invalid").tooltipster("open").first().focus()
        }
    }), $(".fca_cc_optin_input").keypress(function(t) {
        13 == t.which && $(this).siblings("#fca_cc_optin_button").click()
    }), $(".fca_cc_terms").click(function(t) {
        t.preventDefault();
        var c = $(this).closest(".fca_cc_contest");
        c.find(".fca_cc_terms").not(".tooltipstered").tooltipster({
            contentAsHTML: !0,
            trigger: "click",
            maxWidth: 600,
            arrow: !1,
            theme: ["tooltipster-borderless", "tooltipster-contest-cat-terms"]
        }).click()
    })
});
var updateFn = window.setInterval(contest_countdown, 1e3);
